/*!
 * FilePondPluginImageTransform 3.7.0
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).FilePondPluginImageTransform=e()}(this,function(){"use strict";var t={jpeg:"jpg","svg+xml":"svg"},e={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},n=function(t,e){return{x:t,y:e}},i=function(t,e){return n(t.x-e.x,t.y-e.y)},r=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(i(t,e),i(t,e))}(t,e))},o=function(t,e){var i=t,r=e,o=1.5707963267948966-e,a=Math.sin(1.5707963267948966),u=Math.sin(r),c=Math.sin(o),l=Math.cos(o),h=i/a;return n(l*(h*u),l*(h*c))},a=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},u=a.x>.5?1-a.x:a.x,c=a.y>.5?1-a.y:a.y,l=2*u*t.width,h=2*c*t.height,f=function(t,e){var i=t.width,a=t.height,u=o(i,e),c=o(a,e),l=n(t.x+Math.abs(u.x),t.y-Math.abs(u.y)),h=n(t.x+t.width+Math.abs(c.y),t.y+Math.abs(c.x)),f=n(t.x-Math.abs(c.y),t.y+t.height-Math.abs(c.x));return{width:r(l,h),height:r(l,f)}}(e,i);return Math.max(f.width/l,f.height/h)},u=function(t,e){var n=t.width,i=n*e;return i>t.height&&(n=(i=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.height/t.width,r=e,o=1,a=i;a>r&&(o=(a=r)/i);var u=Math.max(1/o,r/a),c=t.width/(n*u*o);return{width:c,height:c*e}},l=function(t){t.width=1,t.height=1,t.getContext("2d").clearRect(0,0,1,1)},h=function(t){return t&&(t.horizontal||t.vertical)},f=function(t,n,i){if(n<=1&&!h(i))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),o=t.naturalWidth,a=t.naturalHeight,u=n>=5&&n<=8;u?(r.width=a,r.height=o):(r.width=o,r.height=a);var c=r.getContext("2d");if(n&&c.transform.apply(c,function(t,n,i){return-1===i&&(i=1),e[i](t,n)}(o,a,n)),h(i)){var l=[1,0,0,1,0,0];(!u&&i.horizontal||u&i.vertical)&&(l[0]=-1,l[4]=o),(!u&&i.vertical||u&&i.horizontal)&&(l[3]=-1,l[5]=a),c.transform.apply(c,l)}return c.drawImage(t,0,0,o,a),r};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(i),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))})}}));var s=function(t,e){return v(t.x*e,t.y*e)},d=function(t,e){return v(t.x+e.x,t.y+e.y)},g=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:v(t.x/e,t.y/e)},y=function(t,e,n){var i=Math.cos(e),r=Math.sin(e),o=v(t.x-n.x,t.y-n.y);return v(n.x+i*o.x-r*o.y,n.y+r*o.x+i*o.y)},v=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},m=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*n:"number"==typeof t?t*(i?e[i]:Math.min(e.width,e.height)):void 0},p=function(t,e,n){var i=t.borderStyle||t.lineStyle||"solid",r=t.backgroundColor||t.fontColor||"transparent",o=t.borderColor||t.lineColor||"transparent",a=m(t.borderWidth||t.lineWidth,e,n);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof i?"":i.map(function(t){return m(t,e,n)}).join(","),stroke:o,fill:r,opacity:t.opacity||1}},w=function(t){return null!=t},x=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=m(t.x,e,n,"width")||m(t.left,e,n,"width"),r=m(t.y,e,n,"height")||m(t.top,e,n,"height"),o=m(t.width,e,n,"width"),a=m(t.height,e,n,"height"),u=m(t.right,e,n,"width"),c=m(t.bottom,e,n,"height");return w(r)||(r=w(a)&&w(c)?e.height-a-c:c),w(i)||(i=w(o)&&w(u)?e.width-o-u:u),w(o)||(o=w(i)&&w(u)?e.width-i-u:0),w(a)||(a=w(r)&&w(c)?e.height-r-c:0),{x:i||0,y:r||0,width:o||0,height:a||0}},T=function(t,e){return Object.keys(e).forEach(function(n){return t.setAttribute(n,e[n])})},M=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&T(n,e),n},b={contain:"xMidYMid meet",cover:"xMidYMid slice"},A={left:"start",center:"middle",right:"end"},_=function(t){return function(e){return M(t,{id:e.id})}},E={image:function(t){var e=M("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=function(){e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:_("rect"),ellipse:_("ellipse"),text:_("text"),path:_("path"),line:function(t){var e=M("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=M("line");e.appendChild(n);var i=M("path");e.appendChild(i);var r=M("path");return e.appendChild(r),e}},R={rect:function(t){return T(t,Object.assign({},t.rect,t.styles))},ellipse:function(t){var e=t.rect.x+.5*t.rect.width,n=t.rect.y+.5*t.rect.height,i=.5*t.rect.width,r=.5*t.rect.height;return T(t,Object.assign({cx:e,cy:n,rx:i,ry:r},t.styles))},image:function(t,e){T(t,Object.assign({},t.rect,t.styles,{preserveAspectRatio:b[e.fit]||"none"}))},text:function(t,e,n,i){var r=m(e.fontSize,n,i),o=e.fontFamily||"sans-serif",a=e.fontWeight||"normal",u=A[e.textAlign]||"start";T(t,Object.assign({},t.rect,t.styles,{"stroke-width":0,"font-weight":a,"font-size":r,"font-family":o,"text-anchor":u})),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},path:function(t,e,n,i){var r;T(t,Object.assign({},t.styles,{fill:"none",d:(r=e.points.map(function(t){return{x:m(t.x,n,i,"width"),y:m(t.y,n,i,"height")}}),r.map(function(t,e){return"".concat(0===e?"M":"L"," ").concat(t.x," ").concat(t.y)}).join(" "))}))},line:function(t,e,n,i){T(t,Object.assign({},t.rect,t.styles,{fill:"none"}));var r=t.childNodes[0],o=t.childNodes[1],a=t.childNodes[2],u=t.rect,c={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(T(r,{x1:u.x,y1:u.y,x2:c.x,y2:c.y}),e.lineDecoration){o.style.display="none",a.style.display="none";var l=g({x:c.x-u.x,y:c.y-u.y}),h=m(.05,n,i);if(-1!==e.lineDecoration.indexOf("arrow-begin")){var f=s(l,h),v=d(u,f),p=y(u,2,v),w=y(u,-2,v);T(o,{style:"display:block;",d:"M".concat(p.x,",").concat(p.y," L").concat(u.x,",").concat(u.y," L").concat(w.x,",").concat(w.y)})}if(-1!==e.lineDecoration.indexOf("arrow-end")){var x=s(l,-h),M=d(c,x),b=y(c,2,M),A=y(c,-2,M);T(a,{style:"display:block;",d:"M".concat(b.x,",").concat(b.y," L").concat(c.x,",").concat(c.y," L").concat(A.x,",").concat(A.y)})}}}},O=function(t,e){return t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0},I=function(t,e,n,i){return new Promise(function(r){var o=i.background,c=void 0===o?null:o,l=new FileReader;l.onloadend=function(){var t=l.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=t;var o=i.querySelector("svg");document.body.appendChild(i);var h=o.getBBox();i.parentNode.removeChild(i);var f=i.querySelector("title"),s=o.getAttribute("viewBox")||"",d=o.getAttribute("width")||"",g=o.getAttribute("height")||"",y=parseFloat(d)||null,v=parseFloat(g)||null,m=(d.match(/[a-z]+/)||[])[0]||"",w=(g.match(/[a-z]+/)||[])[0]||"",T=s.split(" ").map(parseFloat),M=T.length?{x:T[0],y:T[1],width:T[2],height:T[3]}:h,b=null!=y?y:M.width,A=null!=v?v:M.height;o.style.overflow="visible",o.setAttribute("width",b),o.setAttribute("height",A);var _="";if(n&&n.length){var I={width:b,height:A};_=n.sort(O).reduce(function(t,e){var n,i,r=(n=e[0],i=e[1],E[n](i));return function(t,e,n,i,r){"path"!==e&&(t.rect=x(n,i,r)),t.styles=p(n,i,r),R[e](t,n,i,r)}(r,e[0],e[1],I),r.removeAttribute("id"),1===r.getAttribute("opacity")&&r.removeAttribute("opacity"),t+"\n"+r.outerHTML+"\n"},""),_="\n\n<g>".concat(_.replace(/&nbsp;/g," "),"</g>\n\n")}var N=e.aspectRatio||A/b,S=b,C=S*N,k=void 0===e.scaleToFit||e.scaleToFit,L=a({width:b,height:A},u({width:S,height:C},N),e.rotation,k?e.center:{x:.5,y:.5}),B=e.zoom*L,F=e.rotation*(180/Math.PI),P={x:.5*S,y:.5*C},U={x:P.x-b*e.center.x,y:P.y-A*e.center.y},G=["rotate(".concat(F," ").concat(P.x," ").concat(P.y,")"),"translate(".concat(P.x," ").concat(P.y,")"),"scale(".concat(B,")"),"translate(".concat(-P.x," ").concat(-P.y,")"),"translate(".concat(U.x," ").concat(U.y,")")],j=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-b:0," ").concat(e.flip.vertical?-A:0,")")],z='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(S).concat(m,'" height="').concat(C).concat(w,'" \nviewBox="0 0 ').concat(S," ").concat(C,'" ').concat(c?'style="background:'+c+'" ':"",'\npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>').concat(f?f.textContent:"",'</title>\n<g transform="').concat(G.join(" "),'">\n<g transform="').concat(j.join(" "),'">\n').concat(o.outerHTML).concat(_,"\n</g>\n</g>\n</svg>");r(z)},l.readAsText(t)})},N=function(){var t={resize:function(t,e){var i=e.mode,a=void 0===i?"contain":i,u=e.upscale,c=void 0!==u&&u,l=e.width,h=e.height,f=e.matrix;if(f=!f||r(f)?null:f,!l&&!h)return o(t,f);null===l?l=h:null===h&&(h=l);if("force"!==a){var s=l/t.width,d=h/t.height,g=1;if("cover"===a?g=Math.max(s,d):"contain"===a&&(g=Math.min(s,d)),g>1&&!1===c)return o(t,f);l=t.width*g,h=t.height*g}for(var y=t.width,v=t.height,m=Math.round(l),p=Math.round(h),w=t.data,x=new Uint8ClampedArray(m*p*4),T=y/m,M=v/p,b=Math.ceil(.5*T),A=Math.ceil(.5*M),_=0;_<p;_++)for(var E=0;E<m;E++){for(var R=4*(E+_*m),O=0,I=0,N=0,S=0,C=0,k=0,L=0,B=(_+.5)*M,F=Math.floor(_*M);F<(_+1)*M;F++)for(var P=Math.abs(B-(F+.5))/A,U=(E+.5)*T,G=P*P,j=Math.floor(E*T);j<(E+1)*T;j++){var z=Math.abs(U-(j+.5))/b,D=Math.sqrt(G+z*z);if(D>=-1&&D<=1&&(O=2*D*D*D-3*D*D+1)>0){var q=w[(z=4*(j+F*y))+3];L+=O*q,N+=O,q<255&&(O=O*q/250),S+=O*w[z],C+=O*w[z+1],k+=O*w[z+2],I+=O}}x[R]=S/I,x[R+1]=C/I,x[R+2]=k/I,x[R+3]=L/N,f&&n(R,x,f)}return{data:x,width:m,height:p}},filter:o},e=function(e,n){var i=e.transforms,r=null;if(i.forEach(function(t){"filter"===t.type&&(r=t)}),r){var o=null;i.forEach(function(t){"resize"===t.type&&(o=t)}),o&&(o.data.matrix=r.data,i=i.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(i,e.imageData))};function n(t,e,n){for(var i=0,r=0,o=0,a=e[t]/255,u=e[t+1]/255,c=e[t+2]/255,l=e[t+3]/255;i<4;i++)o=255*(a*n[r=5*i]+u*n[r+1]+c*n[r+2]+l*n[r+3]+n[r+4]),e[t+i]=Math.max(0,Math.min(o,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var i=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function r(t){return self.JSON.stringify(t||[])===i}function o(t,e){if(!e||r(e))return t;for(var n=t.data,i=n.length,o=e[0],a=e[1],u=e[2],c=e[3],l=e[4],h=e[5],f=e[6],s=e[7],d=e[8],g=e[9],y=e[10],v=e[11],m=e[12],p=e[13],w=e[14],x=e[15],T=e[16],M=e[17],b=e[18],A=e[19],_=0,E=0,R=0,O=0,I=0;_<i;_+=4)E=n[_]/255,R=n[_+1]/255,O=n[_+2]/255,I=n[_+3]/255,n[_]=Math.max(0,Math.min(255*(E*o+R*a+O*u+I*c+l),255)),n[_+1]=Math.max(0,Math.min(255*(E*h+R*f+O*s+I*d+g),255)),n[_+2]=Math.max(0,Math.min(255*(E*y+R*v+O*m+I*p+w),255)),n[_+3]=Math.max(0,Math.min(255*(E*x+R*T+O*M+I*b+A),255));return t}},S=function(t,e){if(1165519206===t.getUint32(e+4,!1)){e+=4;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var i=t.getUint16(e,n);e+=2;for(var r=0;r<i;r++)if(274===t.getUint16(e+12*r,n))return t.setUint16(e+12*r+8,1,n),!0;return!1}},C=function(t){return new Promise(function(e){var n=new FileReader;n.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,i,r=2,o=!1;r<e.byteLength&&(n=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=S(e,r)),!(r+i>e.byteLength));)r+=i;return t.slice(0,r)}(n.result)||null)},n.readAsArrayBuffer(t.slice(0,262144))})},k=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},L=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n),r=[];return{transfer:function(){},post:function(t,e,n){var o=Math.random().toString(36).substr(2,9);r[o]=e,i.onmessage=function(t){var e=r[t.data.id];e&&(e(t.data.message),delete r[t.data.id])},i.postMessage({id:o,message:t},n)},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}},B=function(t,e){return new Promise(function(n){var i,r={width:t.width,height:t.height},o=t.getContext("2d"),a=e.sort(O).map(function(t){return function(){return new Promise(function(e){U[t[0]](o,r,t[1],e)&&e()})}});(i=a,i.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))).then(function(){return n(t)})})},F=function(t,e){t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},P=function(t){t.fill(),t.stroke(),t.globalAlpha=1},U={rect:function(t,e,n){var i=x(n,e),r=p(n,e);return F(t,r),t.rect(i.x,i.y,i.width,i.height),P(t),!0},ellipse:function(t,e,n){var i=x(n,e),r=p(n,e);F(t,r);var o=i.x,a=i.y,u=i.width,c=i.height,l=u/2*.5522848,h=c/2*.5522848,f=o+u,s=a+c,d=o+u/2,g=a+c/2;return t.moveTo(o,g),t.bezierCurveTo(o,g-h,d-l,a,d,a),t.bezierCurveTo(d+l,a,f,g-h,f,g),t.bezierCurveTo(f,g+h,d+l,s,d,s),t.bezierCurveTo(d-l,s,o,g+h,o,g),P(t),!0},image:function(t,e,n,i){var r=x(n,e),o=p(n,e);F(t,o);var a=new Image;a.onload=function(){if("cover"===n.fit){var e=r.width/r.height,o=e>1?a.width:a.height*e,u=e>1?a.width/e:a.height,c=.5*a.width-.5*o,l=.5*a.height-.5*u;t.drawImage(a,c,l,o,u,r.x,r.y,r.width,r.height)}else if("contain"===n.fit){var h=Math.min(r.width/a.width,r.height/a.height),f=h*a.width,s=h*a.height,d=r.x+.5*r.width-.5*f,g=r.y+.5*r.height-.5*s;t.drawImage(a,0,0,a.width,a.height,d,g,f,s)}else t.drawImage(a,0,0,a.width,a.height,r.x,r.y,r.width,r.height);P(t),i()},a.src=n.src},text:function(t,e,n){var i=x(n,e),r=p(n,e);F(t,r);var o=m(n.fontSize,e),a=n.fontFamily||"sans-serif",u=n.fontWeight||"normal",c=n.textAlign||"left";return t.font="".concat(u," ").concat(o,"px ").concat(a),t.textAlign=c,t.fillText(n.text,i.x,i.y),P(t),!0},line:function(t,e,n){var i=x(n,e),r=p(n,e);F(t,r),t.beginPath();var o={x:i.x,y:i.y},a={x:i.x+i.width,y:i.y+i.height};t.moveTo(o.x,o.y),t.lineTo(a.x,a.y);var u=g({x:a.x-o.x,y:a.y-o.y}),c=.04*Math.min(e.width,e.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){var l=s(u,c),h=d(o,l),f=y(o,2,h),v=y(o,-2,h);t.moveTo(f.x,f.y),t.lineTo(o.x,o.y),t.lineTo(v.x,v.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){var m=s(u,-c),w=d(a,m),T=y(a,2,w),M=y(a,-2,w);t.moveTo(T.x,T.y),t.lineTo(a.x,a.y),t.lineTo(M.x,M.y)}return P(t),!0},path:function(t,e,n){var i=p(n,e);F(t,i),t.beginPath();var r=n.points.map(function(t){return{x:m(t.x,e,1,"width"),y:m(t.y,e,1,"height")}});t.moveTo(r[0].x,r[0].y);for(var o=r.length,a=1;a<o;a++)t.lineTo(r[a].x,r[a].y);return P(t),!0}},G=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,r){if(!t||!function(t){return/^image/.test(t.type)}(t))return r({status:"not an image file",file:t});var o=n.stripImageHead,h=n.beforeCreateBlob,s=n.afterCreateBlob,d=n.canvasMemoryLimit,g=e.crop,y=e.size,v=e.filter,m=e.markup,p=e.output,w=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,x=p&&p.quality,T=null===x?null:x/100,M=p&&p.type||null,b=p&&p.background||null,A=[];!y||"number"!=typeof y.width&&"number"!=typeof y.height||A.push({type:"resize",data:y}),v&&20===v.length&&A.push({type:"filter",data:v});var _=function(t){var e=s?s(t):t;Promise.resolve(e).then(i)},E=function(e,n){var i=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e}(e),a=m.length?B(i,m):i;Promise.resolve(a).then(function(e){(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){var r=n?n(t):t;Promise.resolve(r).then(function(t){t.toBlob(i,e.type,e.quality)})})})(e,n,h).then(function(n){if(l(e),o)return _(n);C(t).then(function(t){null!==t&&(n=new Blob([t,n.slice(20)],{type:n.type})),_(n)})}).catch(r)})};if(/svg/.test(t.type)&&null===M)return I(t,g,m,{background:b}).then(function(t){i(k(t,"image/svg+xml"))});var R=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=function(t){n(t)},i.src=t})})(R).then(function(e){URL.revokeObjectURL(R);var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=i.canvasMemoryLimit,o=i.background,h=void 0===o?null:o,s=n.zoom||1,d=f(t,e,n.flip),g={width:d.width,height:d.height},y=n.aspectRatio||g.height/g.width,v=c(g,y,s);if(r){var m=v.width*v.height;if(m>r){var p=Math.sqrt(r)/Math.sqrt(m);g.width=Math.floor(g.width*p),g.height=Math.floor(g.height*p),v=c(g,y,s)}}var w=document.createElement("canvas"),x={x:.5*v.width,y:.5*v.height},T={x:0,y:0,width:v.width,height:v.height,center:x},M=void 0===n.scaleToFit||n.scaleToFit,b=s*a(g,u(T,y),n.rotation,M?n.center:{x:.5,y:.5});w.width=Math.round(v.width/b),w.height=Math.round(v.height/b),x.x/=b,x.y/=b;var A=x.x-g.width*(n.center?n.center.x:.5),_=x.y-g.height*(n.center?n.center.y:.5),E=w.getContext("2d");h&&(E.fillStyle=h,E.fillRect(0,0,w.width,w.height)),E.translate(x.x,x.y),E.rotate(n.rotation||0),E.drawImage(d,A-x.x,_-x.y,g.width,g.height);var R=E.getImageData(0,0,w.width,w.height);return l(w),R}(e,w,g,{canvasMemoryLimit:d,background:b}),i={quality:T,type:M||t.type};if(!A.length)return E(n,i);var r=L(N);r.post({transforms:A,imageData:n},function(t){E(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),i),r.terminate()},[n.data.buffer])}).catch(r)})};function j(t){this.wrapped=t}function z(t){var e,n;function i(e,n){try{var o=t[e](n),a=o.value,u=a instanceof j;Promise.resolve(u?a.wrapped:a).then(function(t){u?i("next",t):r(o.done?"return":"normal",t)},function(t){i("throw",t)})}catch(t){r("throw",t)}}function r(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new Promise(function(o,a){var u={key:t,arg:r,resolve:o,reject:a,next:null};n?n=n.next=u:(e=n=u,i(t,r))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(z.prototype[Symbol.asyncIterator]=function(){return this}),z.prototype.next=function(t){return this._invoke("next",t)},z.prototype.throw=function(t){return this._invoke("throw",t)},z.prototype.return=function(t){return this._invoke("return",t)};function D(t,e){return q(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}return n}(t,e)||H()}function q(t){if(Array.isArray(t))return t}function H(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var V=["x","y","left","top","right","bottom","width","height"],W=function(t){var e=D(t,2),n=e[0],i=e[1],r=i.points?{}:V.reduce(function(t,e){var n;return t[e]="string"==typeof(n=i[e])&&/%/.test(n)?parseFloat(n)/100:n,t},{});return[n,Object.assign({zIndex:0},i,r)]};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this;setTimeout(function(){for(var r=i.toDataURL(e,n).split(",")[1],o=atob(r),a=o.length,u=new Uint8Array(a);a--;)u[a]=o.charCodeAt(a);t(new Blob([u],{type:e||"image/png"}))})}}));var Y="undefined"!=typeof window&&void 0!==window.document,J=Y&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Q=function(e){var n=e.addFilter,i=e.utils,r=i.Type,o=i.forin,a=i.getFileFromBlob,u=i.isFile,c=["crop","resize","filter","markup","output"],l=function(t){return null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical};n("SHOULD_PREPARE_OUTPUT",function(t,e){var n=e.query;return new Promise(function(t){t(!n("IS_ASYNC"))})});return n("PREPARE_OUTPUT",function(e,n){var i=n.query,r=n.item;return new Promise(function(n){(function(t,e,n){return new Promise(function(i){if(!u(e)||!function(t){return/^image/.test(t.type)}(e)||!t("GET_ALLOW_IMAGE_TRANSFORM")||n.archived)return i(!1);var r=t("GET_IMAGE_TRANSFORM_IMAGE_FILTER");if(r){var o=r(e);if(null==o)return handleRevert(!0);if("boolean"==typeof o)return i(o);if("function"==typeof o.then)return o.then(i)}return i(!0)})})(i,e,r).then(function(u){if(!u)return n(e);var h=[];i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&h.push(function(){return new Promise(function(t){t({name:i("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:e})})}),i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&h.push(function(t,e,n){return new Promise(function(r){t(e,n).then(function(t){return r({name:i("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})})})});var f=i("GET_IMAGE_TRANSFORM_VARIANTS")||{};o(f,function(t,e){var n,i=(n=e,function(t,e,i){return t(e,n?n(i):i)});h.push(function(e,n,r){return new Promise(function(o){i(e,n,r).then(function(e){return o({name:t,file:e})})})})});var s=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),d=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),g=null===s?null:s/100,y=i("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),v=i("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||c;r.setMetadata("output",{type:y,quality:g,client:v},!0);var m=function(e,n){return new Promise(function(r,o){var u=Object.assign({},n);Object.keys(u).filter(function(t){return"exif"!==t}).forEach(function(t){-1===v.indexOf(t)&&delete u[t]});var c=u.resize,h=u.exif,f=u.output,s=u.crop,g=u.filter,y=u.markup,m={image:{orientation:h?h.orientation:null},output:f&&(f.type||"number"==typeof f.quality||f.background)?{type:f.type,quality:"number"==typeof f.quality?100*f.quality:null,background:f.background||i("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||null}:void 0,size:c&&(c.size.width||c.size.height)?Object.assign({mode:c.mode,upscale:c.upscale},c.size):void 0,crop:s&&!l(s)?Object.assign({},s):void 0,markup:y&&y.length?y.map(W):[],filter:g};if(m.output){var p=!!f.type&&f.type!==e.type,w=/\/jpe?g$/.test(e.type),x=null!==f.quality&&(w&&"always"===d);if(!!!(m.size||m.crop||m.filter||p||x))return r(e)}var T={beforeCreateBlob:i("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:i("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:i("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:i("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};G(e,m,T).then(function(n){var i,o=a(n,function(e,n){var i=function(t){return t.substr(0,t.lastIndexOf("."))||t}(e),r=n.split("/")[1],o=t[r]||r;return"".concat(i,".").concat(o)}(e.name,(i=n.type,/jpeg|png|svg\+xml/.test(i)?i:"image/jpeg")));r(o)}).catch(o)})},p=h.map(function(t){return t(m,e,r.getMetadata())});Promise.all(p).then(function(t){n(1===t.length&&null===t[0].name?t[0].file:t)})})})}),{options:{allowImageTransform:[!0,r.BOOLEAN],imageTransformImageFilter:[null,r.FUNCTION],imageTransformOutputMimeType:[null,r.STRING],imageTransformOutputQuality:[null,r.INT],imageTransformOutputStripImageHead:[!0,r.BOOLEAN],imageTransformClientTransforms:[null,r.ARRAY],imageTransformOutputQualityMode:["always",r.STRING],imageTransformVariants:[null,r.OBJECT],imageTransformVariantsIncludeDefault:[!0,r.BOOLEAN],imageTransformVariantsDefaultName:[null,r.STRING],imageTransformVariantsIncludeOriginal:[!1,r.BOOLEAN],imageTransformVariantsOriginalName:["original_",r.STRING],imageTransformBeforeCreateBlob:[null,r.FUNCTION],imageTransformAfterCreateBlob:[null,r.FUNCTION],imageTransformCanvasMemoryLimit:[Y&&J?16777216:null,r.INT],imageTransformCanvasBackgroundColor:[null,r.STRING]}}};return Y&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:Q})),Q});
